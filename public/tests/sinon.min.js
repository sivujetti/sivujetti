/**
 * https://cdn.jsdelivr.net/npm/sinon@1.17.6/pkg/sinon.min.js
 *
 * Minified by jsDelivr using UglifyJS v3.4.4.
 * Original file: /npm/sinon@1.17.6/pkg/sinon.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
!function(e,t){"use strict";"function"==typeof define&&define.amd?define("sinon",[],function(){return e.sinon=t()}):"object"==typeof exports?module.exports=t():e.sinon=t()}(this,function(){"use strict";var samsam,formatio,lolex,define;!function(){function define(e,t,n){"samsam"==e?samsam=t():"function"==typeof t&&0===e.length?lolex=t():"function"==typeof n&&(formatio=n(samsam))}define.amd={},("function"==typeof define&&define.amd&&function(e){define("samsam",e)}||"object"==typeof module&&function(e){module.exports=e()}||function(e){this.samsam=e()})(function(){var s,R=Object.prototype,t="undefined"!=typeof document&&document.createElement("div");function D(e){return"number"==typeof e&&e!==e}function P(e){return R.toString.call(e).split(/[ \]]/)[1]}function I(e){if("Arguments"===P(e))return!0;if("object"!=typeof e||"number"!=typeof e.length||"Array"===P(e))return!1;if("function"==typeof e.callee)return!0;try{e[e.length]=6,delete e[e.length]}catch(e){return!0}return!1}function N(e){if(!e||1!==e.nodeType||!t)return!1;try{e.appendChild(t),e.removeChild(t)}catch(e){return!1}return!0}function M(e){var t,n=[];for(t in e)R.hasOwnProperty.call(e,t)&&n.push(t);return n}function L(e){return"function"==typeof e.getTime&&e.getTime()==e.valueOf()}function n(e){return 0===e&&1/e==-1/0}function F(e,t){if(e===t||D(e)&&D(t))return 0!==e||n(e)===n(t)}return{isArguments:I,isElement:N,isDate:L,isNegZero:n,identical:F,deepEqual:function(e,t){var T=[],k=[],A=[],j=[],O={};function S(e){return!("object"!=typeof e||null===e||e instanceof Boolean||e instanceof Date||e instanceof Number||e instanceof RegExp||e instanceof String)}function q(e,t){var n;for(n=0;n<e.length;n++)if(e[n]===t)return n;return-1}return function e(t,n,r,o){var i=typeof t,s=typeof n;if(t===n||D(t)||D(n)||null==t||null==n||"object"!==i||"object"!==s)return F(t,n);if(N(t)||N(n))return!1;var a=L(t),l=L(n);if((a||l)&&(!a||!l||t.getTime()!==n.getTime()))return!1;if(t instanceof RegExp&&n instanceof RegExp&&t.toString()!==n.toString())return!1;var c,u,f,h,p,d,y,m,g,v,b,w=P(t),x=P(n),C=M(t),E=M(n);if(I(t)||I(n)){if(t.length!==n.length)return!1}else if(i!==s||w!==x||C.length!==E.length)return!1;for(u=0,f=C.length;u<f;u++){if(c=C[u],!R.hasOwnProperty.call(n,c))return!1;if(h=t[c],p=n[c],d=S(h),y=S(p),m=d?q(T,h):-1,g=y?q(k,p):-1,v=-1!==m?A[m]:r+"["+JSON.stringify(c)+"]",b=-1!==g?j[g]:o+"["+JSON.stringify(c)+"]",O[v+b])return!0;if(-1===m&&d&&(T.push(h),A.push(v)),-1===g&&y&&(k.push(p),j.push(b)),d&&y&&(O[v+b]=!0),!e(h,p,v,b))return!1}return!0}(e,t,"$1","$2")},match:s=function e(t,n){if(n&&"function"==typeof n.test)return n.test(t);if("function"==typeof n)return!0===n(t);if("string"==typeof n)return n=n.toLowerCase(),("string"==typeof t||!!t)&&0<=String(t).toLowerCase().indexOf(n);if("number"==typeof n)return n===t;if("boolean"==typeof n)return n===t;if(void 0===n)return void 0===t;if(null===n)return null===t;if("Array"===P(t)&&"Array"===P(n))return function(e,t){if(0===t.length)return!0;var n,r,o,i;for(n=0,r=e.length;n<r;++n)if(s(e[n],t[0])){for(o=0,i=t.length;o<i;++o)if(!s(e[n+o],t[o]))return!1;return!0}return!1}(t,n);if(n&&"object"==typeof n){if(n===t)return!0;var r;for(r in n){var o=t[r];if(void 0===o&&"function"==typeof t.getAttribute&&(o=t.getAttribute(r)),null===n[r]||void 0===n[r]){if(o!==n[r])return!1}else if(void 0===o||!e(o,n[r]))return!1}return!0}throw new Error("Matcher was not a string, a number, a function, a boolean or an object")},keys:M}}),("function"==typeof define&&define.amd&&function(e){define("formatio",["samsam"],e)}||"object"==typeof module&&function(e){module.exports=e(require("samsam"))}||function(e){this.formatio=e(this.samsam)})(function(y){var s={excludeConstructors:["Object",/^.$/],quoteStrings:!0,limitChildrenCount:0},a=(Object.prototype.hasOwnProperty,[]);function l(e){if(!e)return"";if(e.displayName)return e.displayName;if(e.name)return e.name;var t=e.toString().match(/function\s+([^\(]+)/m);return t&&t[1]||""}function m(e,t){var n,r,o=l(t&&t.constructor),i=e.excludeConstructors||s.excludeConstructors||[];for(n=0,r=i.length;n<r;++n){if("string"==typeof i[n]&&i[n]===o)return"";if(i[n].test&&i[n].test(o))return""}return o}function g(e,t){if("object"!=typeof e)return!1;var n,r;for(n=0,r=t.length;n<r;++n)if(t[n]===e)return!0;return!1}function v(e,t,n,r){if("string"==typeof t){var o=e.quoteStrings;return n||("boolean"!=typeof o||o)?'"'+t+'"':t}if("function"==typeof t&&!(t instanceof RegExp))return v.func(t);if(g(t,n=n||[]))return"[Circular]";if("[object Array]"===Object.prototype.toString.call(t))return v.array.call(e,t,n);if(!t)return String(1/t==-1/0?"-0":t);if(y.isElement(t))return v.element(t);if("function"==typeof t.toString&&t.toString!==Object.prototype.toString)return t.toString();var i,s;for(i=0,s=a.length;i<s;i++)if(t===a[i].object)return a[i].value;return v.object.call(e,t,n,r)}function t(e){for(var t in e)this[t]=e[t]}return"undefined"!=typeof global&&a.push({object:global,value:"[object global]"}),"undefined"!=typeof document&&a.push({object:document,value:"[object HTMLDocument]"}),"undefined"!=typeof window&&a.push({object:window,value:"[object Window]"}),v.func=function(e){return"function "+l(e)+"() {}"},v.array=function(e,t){(t=t||[]).push(e);var n,r,o=[];for(r=0<this.limitChildrenCount?Math.min(this.limitChildrenCount,e.length):e.length,n=0;n<r;++n)o.push(v(this,e[n],t));return r<e.length&&o.push("[... "+(e.length-r)+" more elements]"),"["+o.join(", ")+"]"},v.object=function(e,t,n){(t=t||[]).push(e),n=n||0;var r,o,i,s,a,l,c=[],u=y.keys(e).sort(),f=3;for(l=0<this.limitChildrenCount?Math.min(this.limitChildrenCount,u.length):u.length,s=0;s<l;++s)o=g(i=e[r=u[s]],t)?"[Circular]":v(this,i,t,n+2),f+=(o=(/\s/.test(r)?'"'+r+'"':r)+": "+o).length,c.push(o);var h=m(this,e),p=h?"["+h+"] ":"",d="";for(s=0,a=n;s<a;++s)d+=" ";return l<u.length&&c.push("[... "+(u.length-l)+" more elements]"),80<f+n?p+"{\n  "+d+c.join(",\n  "+d)+"\n"+d+"}":p+"{ "+c.join(", ")+" }"},v.element=function(e){var t,n,r,o,i,s=e.tagName.toLowerCase(),a=e.attributes,l=[];for(r=0,o=a.length;r<o;++r)n=(t=a.item(r)).nodeName.toLowerCase().replace("html:",""),i=t.nodeValue,"contenteditable"===n&&"inherit"===i||i&&l.push(n+'="'+i+'"');var c="<"+s+(0<l.length?" ":""),u=e.innerHTML;return 20<u.length&&(u=u.substr(0,20)+"[...]"),(c+l.join(" ")+">"+u+"</"+s+">").replace(/ contentEditable="inherit"/,"")},t.prototype={functionName:l,configure:function(e){return new t(e)},constructorName:function(e){return m(this,e)},ascii:function(e,t,n){return v(this,e,t,n)}}}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.lolex=e()}}(function(){var define,module,exports;return function i(s,a,l){function c(n,e){if(!a[n]){if(!s[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(u)return u(n,!0);var r=new Error("Cannot find module '"+n+"'");throw r.code="MODULE_NOT_FOUND",r}var o=a[n]={exports:{}};s[n][0].call(o.exports,function(e){var t=s[n][1][e];return c(t||e)},o,o.exports,i,s,a,l)}return a[n].exports}for(var u="function"==typeof require&&require,e=0;e<l.length;e++)c(l[e]);return c}({1:[function(require,module,exports){(function(global){!function(global){var glbl=global;global.setTimeout=glbl.setTimeout,global.clearTimeout=glbl.clearTimeout,global.setInterval=glbl.setInterval,global.clearInterval=glbl.clearInterval,global.Date=glbl.Date,"setImmediate"in global&&(global.setImmediate=glbl.setImmediate,global.clearImmediate=glbl.clearImmediate);var NOOP=function(){},timeoutResult=setTimeout(NOOP,0),addTimerReturnsObject="object"==typeof timeoutResult;clearTimeout(timeoutResult);var NativeDate=Date,uniqueTimerId=1;function parseTime(e){if(!e)return 0;var t,n=e.split(":"),r=n.length,o=r,i=0;if(3<r||!/^(\d\d:){0,2}\d\d?$/.test(e))throw new Error("tick only understands numbers and 'h:m:s'");for(;o--;){if(60<=(t=parseInt(n[o],10)))throw new Error("Invalid time "+e);i+=t*Math.pow(60,r-o-1)}return 1e3*i}function getEpoch(e){if(!e)return 0;if("function"==typeof e.getTime)return e.getTime();if("number"==typeof e)return e;throw new TypeError("now should be milliseconds since UNIX epoch")}function inRange(e,t,n){return n&&n.callAt>=e&&n.callAt<=t}function mirrorDateProperties(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return t.now?e.now=function(){return e.clock.now}:delete e.now,t.toSource?e.toSource=function(){return t.toSource()}:delete e.toSource,e.toString=function(){return t.toString()},e.prototype=t.prototype,e.parse=t.parse,e.UTC=t.UTC,e.prototype.toUTCString=t.prototype.toUTCString,e}function createDate(){return mirrorDateProperties(function e(t,n,r,o,i,s,a){switch(arguments.length){case 0:return new NativeDate(e.clock.now);case 1:return new NativeDate(t);case 2:return new NativeDate(t,n);case 3:return new NativeDate(t,n,r);case 4:return new NativeDate(t,n,r,o);case 5:return new NativeDate(t,n,r,o,i);case 6:return new NativeDate(t,n,r,o,i,s);default:return new NativeDate(t,n,r,o,i,s,a)}},NativeDate)}function addTimer(e,t){if(void 0===t.func)throw new Error("Callback must be provided to timer calls");return e.timers||(e.timers={}),t.id=uniqueTimerId++,t.createdAt=e.now,t.callAt=e.now+(t.delay||(e.duringTick?1:0)),e.timers[t.id]=t,addTimerReturnsObject?{id:t.id,ref:NOOP,unref:NOOP}:t.id}function compareTimers(e,t){return e.callAt<t.callAt?-1:e.callAt>t.callAt?1:e.immediate&&!t.immediate?-1:!e.immediate&&t.immediate?1:e.createdAt<t.createdAt?-1:e.createdAt>t.createdAt?1:e.id<t.id?-1:e.id>t.id?1:void 0}function firstTimerInRange(e,t,n){var r,o=e.timers,i=null;for(r in o)o.hasOwnProperty(r)&&(!inRange(t,n,o[r])||i&&1!==compareTimers(i,o[r])||(i=o[r]));return i}function callTimer(clock,timer){var exception;"number"==typeof timer.interval?clock.timers[timer.id].callAt+=timer.interval:delete clock.timers[timer.id];try{"function"==typeof timer.func?timer.func.apply(null,timer.args):eval(timer.func)}catch(e){exception=e}if(clock.timers[timer.id]){if(exception)throw exception}else if(exception)throw exception}function timerType(e){return e.immediate?"Immediate":void 0!==e.interval?"Interval":"Timeout"}function clearTimer(e,t,n){if(t&&(e.timers||(e.timers=[]),"object"==typeof t&&(t=t.id),e.timers.hasOwnProperty(t))){var r=e.timers[t];if(timerType(r)!==n)throw new Error("Cannot clear timer: timer created with set"+n+"() but cleared with clear"+timerType(r)+"()");delete e.timers[t]}}function uninstall(e,t){var n,r,o;for(r=0,o=e.methods.length;r<o;r++)if(t[n=e.methods[r]].hadOwnProperty)t[n]=e["_"+n];else try{delete t[n]}catch(e){}e.methods=[]}function hijackMethod(e,t,n){var r;if(n[t].hadOwnProperty=Object.prototype.hasOwnProperty.call(e,t),n["_"+t]=e[t],"Date"===t){var o=mirrorDateProperties(n[t],e[t]);e[t]=o}else for(r in e[t]=function(){return n[t].apply(n,arguments)},n[t])n[t].hasOwnProperty(r)&&(e[t][r]=n[t][r]);e[t].clock=n}var timers={setTimeout:setTimeout,clearTimeout:clearTimeout,setImmediate:global.setImmediate,clearImmediate:global.clearImmediate,setInterval:setInterval,clearInterval:clearInterval,Date:Date},keys=Object.keys||function(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&n.push(t);return n};function createClock(e){var a={now:getEpoch(e),timeouts:{},Date:createDate()};return(a.Date.clock=a).setTimeout=function(e,t){return addTimer(a,{func:e,args:Array.prototype.slice.call(arguments,2),delay:t})},a.clearTimeout=function(e){return clearTimer(a,e,"Timeout")},a.setInterval=function(e,t){return addTimer(a,{func:e,args:Array.prototype.slice.call(arguments,2),delay:t,interval:t})},a.clearInterval=function(e){return clearTimer(a,e,"Interval")},a.setImmediate=function(e){return addTimer(a,{func:e,args:Array.prototype.slice.call(arguments,1),immediate:!0})},a.clearImmediate=function(e){return clearTimer(a,e,"Immediate")},a.tick=function(e){e="number"==typeof e?e:parseTime(e);var t,n,r=a.now,o=a.now+e,i=a.now,s=firstTimerInRange(a,r,o);for(a.duringTick=!0;s&&r<=o;){if(a.timers[s.id]){r=a.now=s.callAt;try{t=a.now,callTimer(a,s),t!==a.now&&(r+=a.now-t,o+=a.now-t,i+=a.now-t)}catch(e){n=n||e}}s=firstTimerInRange(a,i,o),i=r}if(a.duringTick=!1,a.now=o,n)throw n;return a.now},a.reset=function(){a.timers={}},a.setSystemTime=function(e){var t=getEpoch(e),n=t-a.now;for(var r in a.now=t,a.timers)if(a.timers.hasOwnProperty(r)){var o=a.timers[r];o.createdAt+=n,o.callAt+=n}},a}exports.timers=timers,exports.createClock=createClock,exports.install=function(e,t,n){var r,o;"number"==typeof e&&(n=t,t=e,e=null),e||(e=global);var i=createClock(t);for(i.uninstall=function(){uninstall(i,e)},i.methods=n||[],0===i.methods.length&&(i.methods=keys(timers)),r=0,o=i.methods.length;r<o;r++)hijackMethod(e,i.methods[r],i);return i}}(global||this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)})}();var sinon=function(){var r,e="undefined"!=typeof module&&module.exports&&"function"==typeof require;function t(e,t,n){r=n.exports=e("./sinon/util/core"),e("./sinon/extend"),e("./sinon/walk"),e("./sinon/typeOf"),e("./sinon/times_in_words"),e("./sinon/spy"),e("./sinon/call"),e("./sinon/behavior"),e("./sinon/stub"),e("./sinon/mock"),e("./sinon/collection"),e("./sinon/assert"),e("./sinon/sandbox"),e("./sinon/test"),e("./sinon/test_case"),e("./sinon/match"),e("./sinon/format"),e("./sinon/log_error")}return"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(t):e?(t(require,module.exports,module),r=module.exports):r={},r}();function getGlobal(){return"undefined"!=typeof window?window:global}return function(e){var n="undefined"!=typeof document&&document.createElement("div"),p=Object.prototype.hasOwnProperty;function a(e){return n&&e&&1===e.nodeType&&function(e){var t=!1;try{e.appendChild(n),t=n.parentNode===e}catch(e){return!1}finally{try{e.removeChild(n)}catch(e){}}return t}(e)}function l(e){return"number"==typeof e&&isNaN(e)}function d(e,t){for(var n in t)p.call(e,n)||(e[n]=t[n])}function r(e){return"function"==typeof e&&"function"==typeof e.restore&&e.restore.sinon}var y="keys"in Object;function o(h){return h.wrapMethod=function(e,o,t){if(!e)throw new TypeError("Should wrap property of object");if("function"!=typeof t&&"object"!=typeof t)throw new TypeError("Method wrapper should be a function or a property descriptor");function n(e){var t,n;if("function"==typeof(n=e)||n&&n.constructor&&n.call&&n.apply){if(e.restore&&e.restore.sinon)t=new TypeError("Attempted to wrap "+o+" which is already wrapped");else if(e.calledBefore){var r=e.returns?"stubbed":"spied on";t=new TypeError("Attempted to wrap "+o+" which is already "+r)}}else t=new TypeError("Attempted to wrap "+typeof e+" property "+o+" as function");if(t)throw e&&e.stackTrace&&(t.stack+="\n--------------\n"+e.stackTrace),t}var r,i,s;function a(){n(i=e[o]),(e[o]=t).displayName=o}var l=e.hasOwnProperty?e.hasOwnProperty(o):p.call(e,o);if(y){var c="function"==typeof t?{value:t}:t,u=h.getPropertyDescriptor(e,o);if(u?u.restore&&u.restore.sinon&&(r=new TypeError("Attempted to wrap "+o+" which is already wrapped")):r=new TypeError("Attempted to wrap "+typeof i+" property "+o+" as function"),r)throw u&&u.stackTrace&&(r.stack+="\n--------------\n"+u.stackTrace),r;var f=h.objectKeys(c);for(s=0;s<f.length;s++)n(i=u[f[s]]);for(d(c,u),s=0;s<f.length;s++)d(c[f[s]],u[f[s]]);Object.defineProperty(e,o,c),"function"==typeof t&&e[o]!==t&&(delete e[o],a())}else a();return t.displayName=o,t.stackTrace=new Error("Stack Trace for original").stack,t.restore=function(){if(l)y&&Object.defineProperty(e,o,u);else try{delete e[o]}catch(e){}e[o]===t&&(e[o]=i)},t.restore.sinon=!0,y||d(t,i),t},h.create=function(e){var t=function(){};return t.prototype=e,new t},h.deepEqual=function e(t,n){if(h.match&&h.match.isMatcher(t))return t.test(n);if("object"!=typeof t||"object"!=typeof n)return l(t)&&l(n)||t===n;if(a(t)||a(n))return t===n;if(t===n)return!0;if(null===t&&null!==n||null!==t&&null===n)return!1;if(t instanceof RegExp&&n instanceof RegExp)return t.source===n.source&&t.global===n.global&&t.ignoreCase===n.ignoreCase&&t.multiline===n.multiline;var r,o=Object.prototype.toString.call(t);if(o!==Object.prototype.toString.call(n))return!1;if("[object Date]"===o)return t.valueOf()===n.valueOf();var i=0,s=0;if("[object Array]"===o&&t.length!==n.length)return!1;for(r in t)if(p.call(t,r)){if(i+=1,!(r in n))return!1;if(!e(t[r],n[r]))return!1}for(r in n)p.call(n,r)&&(s+=1);return i===s},h.functionName=function(e){var t=e.displayName||e.name;if(!t){var n=e.toString().match(/function ([^\s\(]+)/);t=n&&n[1]}return t},h.functionToString=function(){if(this.getCall&&this.callCount)for(var e,t,n=this.callCount;n--;)for(t in e=this.getCall(n).thisValue)if(e[t]===this)return t;return this.displayName||"sinon fake"},h.objectKeys=function(e){if(e!==Object(e))throw new TypeError("sinon.objectKeys called on a non-object");var t,n=[];for(t in e)p.call(e,t)&&n.push(t);return n},h.getPropertyDescriptor=function(e,t){for(var n,r=e;r&&!(n=Object.getOwnPropertyDescriptor(r,t));)r=Object.getPrototypeOf(r);return n},h.getConfig=function(e){var t={};e=e||{};var n=h.defaultConfig;for(var r in n)n.hasOwnProperty(r)&&(t[r]=e.hasOwnProperty(r)?e[r]:n[r]);return t},h.defaultConfig={injectIntoThis:!0,injectInto:null,properties:["spy","stub","mock","clock","server","requests"],useFakeTimers:!0,useFakeServer:!0},h.timesInWords=function(e){return(1===e?"once":2===e&&"twice")||3===e&&"thrice"||(e||0)+" times"},h.calledInOrder=function(e){for(var t=1,n=e.length;t<n;t++)if(!e[t-1].calledBefore(e[t])||!e[t].called)return!1;return!0},h.orderByFirstCall=function(e){return e.sort(function(e,t){var n=e.getCall(0),r=t.getCall(0);return(n&&n.callId||-1)<(r&&r.callId||-1)?-1:1})},h.createStubInstance=function(e){if("function"!=typeof e)throw new TypeError("The constructor should be a function.");return h.stub(h.create(e.prototype))},h.restore=function(e){if(null!==e&&"object"==typeof e)for(var t in e)r(e[t])&&e[t].restore();else r(e)&&e.restore()},h}var t="undefined"!=typeof module&&module.exports&&"function"==typeof require;function i(e,t){o(t)}"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(i):t?i(require,module.exports,module):e&&o(e)}("object"==typeof sinon&&sinon),function(e){function o(e){var i=function(){var e={constructor:function(){return"0"},toString:function(){return"1"},valueOf:function(){return"2"},toLocaleString:function(){return"3"},prototype:function(){return"4"},isPrototypeOf:function(){return"5"},propertyIsEnumerable:function(){return"6"},hasOwnProperty:function(){return"7"},length:function(){return"8"},unique:function(){return"9"}},t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]());return"0123456789"!==t.join("")}();return e.extend=function(e){var t,n,r,o=Array.prototype.slice.call(arguments,1);for(n=0;n<o.length;n++){for(r in t=o[n])t.hasOwnProperty(r)&&(e[r]=t[r]);i&&t.hasOwnProperty("toString")&&t.toString!==e.toString&&(e.toString=t.toString)}return e},e.extend}function t(e,t,n){var r=e("./util/core");n.exports=o(r)}var n="undefined"!=typeof module&&module.exports&&"function"==typeof require;"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(t):n?t(require,module.exports,module):e&&o(e)}("object"==typeof sinon&&sinon),function(e){function o(e){return e.timesInWords=function(e){switch(e){case 1:return"once";case 2:return"twice";case 3:return"thrice";default:return(e||0)+" times"}},e.timesInWords}function t(e,t,n){var r=e("./util/core");n.exports=o(r)}var n="undefined"!=typeof module&&module.exports&&"function"==typeof require;"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(t):n?t(require,module.exports,module):e&&o(e)}("object"==typeof sinon&&sinon),function(e){function o(e){return e.typeOf=function(e){if(null===e)return"null";if(void 0===e)return"undefined";var t=Object.prototype.toString.call(e);return t.substring(8,t.length-1).toLowerCase()},e.typeOf}function t(e,t,n){var r=e("./util/core");n.exports=o(r)}var n="undefined"!=typeof module&&module.exports&&"function"==typeof require;"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(t):n?t(require,module.exports,module):e&&o(e)}("object"==typeof sinon&&sinon),function(e){function o(s){function a(e,t,n){var r=s.typeOf(e);if(r!==t)throw new TypeError("Expected type of "+n+" to be "+t+", but was "+r)}var i={toString:function(){return this.message}};function l(e){return i.isPrototypeOf(e)}function c(t,e){var n=s.create(i);switch(s.typeOf(t)){case"object":if("function"==typeof t.test)return n.test=function(e){return!0===t.test(e)},n.message="match("+s.functionName(t.test)+")",n;var r=[];for(var o in t)t.hasOwnProperty(o)&&r.push(o+": "+t[o]);n.test=function(e){return function e(t,n){if(null==n)return!1;for(var r in t)if(t.hasOwnProperty(r)){var o=t[r],i=n[r];if(l(o)){if(!o.test(i))return!1}else if("object"===s.typeOf(o)){if(!e(o,i))return!1}else if(!s.deepEqual(o,i))return!1}return!0}(t,e)},n.message="match("+r.join(", ")+")";break;case"number":n.test=function(e){return t==e};break;case"string":n.test=function(e){return"string"==typeof e&&-1!==e.indexOf(t)},n.message='match("'+t+'")';break;case"regexp":n.test=function(e){return"string"==typeof e&&t.test(e)};break;case"function":n.test=t,n.message=e||"match("+s.functionName(t)+")";break;default:n.test=function(e){return s.deepEqual(t,e)}}return n.message||(n.message="match("+t+")"),n}function e(o,i){return function(t,n){a(t,"string","property");var r=1===arguments.length,e=i+'("'+t+'"';return r||(e+=", "+n),c(function(e){return!(null==e||!o(e,t))&&(r||s.deepEqual(n,e[t]))},e+=")")}}return i.or=function(t){if(!arguments.length)throw new TypeError("Matcher expected");l(t)||(t=c(t));var n=this,e=s.create(i);return e.test=function(e){return n.test(e)||t.test(e)},e.message=n.message+".or("+t.message+")",e},i.and=function(t){if(!arguments.length)throw new TypeError("Matcher expected");l(t)||(t=c(t));var n=this,e=s.create(i);return e.test=function(e){return n.test(e)&&t.test(e)},e.message=n.message+".and("+t.message+")",e},c.isMatcher=l,c.any=c(function(){return!0},"any"),c.defined=c(function(e){return null!=e},"defined"),c.truthy=c(function(e){return!!e},"truthy"),c.falsy=c(function(e){return!e},"falsy"),c.same=function(t){return c(function(e){return t===e},"same("+t+")")},c.typeOf=function(t){return a(t,"string","type"),c(function(e){return s.typeOf(e)===t},'typeOf("'+t+'")')},c.instanceOf=function(t){return a(t,"function","type"),c(function(e){return e instanceof t},"instanceOf("+s.functionName(t)+")")},c.has=e(function(e,t){return"object"==typeof e?t in e:void 0!==e[t]},"has"),c.hasOwn=e(function(e,t){return e.hasOwnProperty(t)},"hasOwn"),c.bool=c.typeOf("boolean"),c.number=c.typeOf("number"),c.string=c.typeOf("string"),c.object=c.typeOf("object"),c.func=c.typeOf("function"),c.array=c.typeOf("array"),c.regexp=c.typeOf("regexp"),c.date=c.typeOf("date"),s.match=c}var t="undefined"!=typeof module&&module.exports&&"function"==typeof require;function n(e,t,n){var r=e("./util/core");e("./typeOf"),n.exports=o(r)}"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(n):t?n(require,module.exports,module):e&&o(e)}("object"==typeof sinon&&sinon),function(e,i){function o(e){function n(e){return""+e}var t,r,o="undefined"!=typeof module&&module.exports&&"function"==typeof require;if(o)try{i=require("formatio")}catch(e){}return i?(r=i.configure({quoteStrings:!1,limitChildrenCount:250}),t=function(){return r.ascii.apply(r,arguments)}):t=o?function(){try{var t=require("util")}catch(e){}return t?function(e){return"object"==typeof e&&e.toString===Object.prototype.toString?t.inspect(e):e}:n}():n,e.format=t,e.format}function t(e,t,n){var r=e("./util/core");n.exports=o(r)}var n="undefined"!=typeof module&&module.exports&&"function"==typeof require;"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(t):n?t(require,module.exports,module):e&&o(e)}("object"==typeof sinon&&sinon,"object"==typeof formatio&&formatio),function(e){var s=Array.prototype.slice;function o(l){function i(e,t,n){var r=l.functionName(e)+t;throw n.length&&(r+=" Received ["+s.call(n).join(", ")+"]"),new Error(r)}var c={calledOn:function(e){return l.match&&l.match.isMatcher(e)?e.test(this.thisValue):this.thisValue===e},calledWith:function(){var e=arguments.length;if(e>this.args.length)return!1;for(var t=0;t<e;t+=1)if(!l.deepEqual(arguments[t],this.args[t]))return!1;return!0},calledWithMatch:function(){var e=arguments.length;if(e>this.args.length)return!1;for(var t=0;t<e;t+=1){var n=this.args[t],r=arguments[t];if(!l.match||!l.match(r).test(n))return!1}return!0},calledWithExactly:function(){return arguments.length===this.args.length&&this.calledWith.apply(this,arguments)},notCalledWith:function(){return!this.calledWith.apply(this,arguments)},notCalledWithMatch:function(){return!this.calledWithMatch.apply(this,arguments)},returned:function(e){return l.deepEqual(e,this.returnValue)},threw:function(e){return void 0!==e&&this.exception?this.exception===e||this.exception.name===e:!!this.exception},calledWithNew:function(){return this.proxy.prototype&&this.thisValue instanceof this.proxy},calledBefore:function(e){return this.callId<e.callId},calledAfter:function(e){return this.callId>e.callId},callArg:function(e){this.args[e]()},callArgOn:function(e,t){this.args[e].apply(t)},callArgWith:function(e){this.callArgOnWith.apply(this,[e,null].concat(s.call(arguments,1)))},callArgOnWith:function(e,t){var n=s.call(arguments,2);this.args[e].apply(t,n)},yield:function(){this.yieldOn.apply(this,[null].concat(s.call(arguments,0)))},yieldOn:function(e){for(var t=this.args,n=0,r=t.length;n<r;++n)if("function"==typeof t[n])return void t[n].apply(e,s.call(arguments,1));i(this.proxy," cannot yield since no callback was passed.",t)},yieldTo:function(e){this.yieldToOn.apply(this,[e,null].concat(s.call(arguments,1)))},yieldToOn:function(e,t){for(var n=this.args,r=0,o=n.length;r<o;++r)if(n[r]&&"function"==typeof n[r][e])return void n[r][e].apply(t,s.call(arguments,2));i(this.proxy," cannot yield to '"+e+"' since no callback was passed.",n)},getStackFrames:function(){return this.stack&&this.stack.split("\n").slice(3)},toString:function(){var e=this.proxy?this.proxy.toString()+"(":"",t=[];if(!this.args)return":(";for(var n=0,r=this.args.length;n<r;++n)t.push(l.format(this.args[n]));return e=e+t.join(", ")+")",void 0!==this.returnValue&&(e+=" => "+l.format(this.returnValue)),this.exception&&(e+=" !"+this.exception.name,this.exception.message&&(e+="("+this.exception.message+")")),this.stack&&(e+=this.getStackFrames()[0].replace(/^\s*(?:at\s+|@)?/," at ")),e}};function e(e,t,n,r,o,i,s){if("number"!=typeof i)throw new TypeError("Call id is not a number");var a=l.create(c);return a.proxy=e,a.thisValue=t,a.args=n,a.returnValue=r,a.exception=o,a.callId=i,a.stack=s,a}return c.invokeCallback=c.yield,e.toString=c.toString,l.spyCall=e}var t="undefined"!=typeof module&&module.exports&&"function"==typeof require;function n(e,t,n){var r=e("./util/core");e("./match"),e("./format"),n.exports=o(r)}"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(n):t?n(require,module.exports,module):e&&o(e)}("object"==typeof sinon&&sinon),function(sinonGlobal){function makeApi(sinon){var push=Array.prototype.push,slice=Array.prototype.slice,callId=0;function spy(e,t,n){if(!t&&"function"==typeof e)return spy.create(e);if(!e&&!t)return spy.create(function(){});if(n){for(var r=sinon.getPropertyDescriptor(e,t),o=0;o<n.length;o++)r[n[o]]=spy.create(r[n[o]]);return sinon.wrapMethod(e,t,r)}return sinon.wrapMethod(e,t,spy.create(e[t]))}function matchingFake(e,t,n){if(e)for(var r=0,o=e.length;r<o;r++)if(e[r].matches(t,n))return e[r]}function incrementCallCount(){this.called=!0,this.callCount+=1,this.notCalled=!1,this.calledOnce=1===this.callCount,this.calledTwice=2===this.callCount,this.calledThrice=3===this.callCount}function createCallProperties(){this.firstCall=this.getCall(0),this.secondCall=this.getCall(1),this.thirdCall=this.getCall(2),this.lastCall=this.getCall(this.callCount-1)}var vars="a,b,c,d,e,f,g,h,i,j,k,l";function createProxy(func,proxyLength){var p;return proxyLength?eval("p = (function proxy("+vars.substring(0,2*proxyLength-1)+") { return p.invoke(func, this, slice.call(arguments)); });"):p=function(){return p.invoke(func,this,slice.call(arguments))},p.isSinonProxy=!0,p}var uuid=0,spyApi={reset:function(){if(this.invoking){var e=new Error("Cannot reset Sinon function while invoking it. Move the call to .reset outside of the callback.");throw e.name="InvalidResetException",e}if(this.called=!1,this.notCalled=!0,this.calledOnce=!1,this.calledTwice=!1,this.calledThrice=!1,this.callCount=0,this.firstCall=null,this.secondCall=null,this.thirdCall=null,this.lastCall=null,this.args=[],this.returnValues=[],this.thisValues=[],this.exceptions=[],this.callIds=[],this.stacks=[],this.fakes)for(var t=0;t<this.fakes.length;t++)this.fakes[t].reset();return this},create:function(e,t){var n;"function"!=typeof e?e=function(){}:n=sinon.functionName(e),t||(t=e.length);var r=createProxy(e,t);return sinon.extend(r,spy),delete r.create,sinon.extend(r,e),r.reset(),r.prototype=e.prototype,r.displayName=n||"spy",r.toString=sinon.functionToString,r.instantiateFake=sinon.spy.create,r.id="spy#"+uuid++,r},invoke:function(e,t,n){var r,o,i=matchingFake(this.fakes,n);incrementCallCount.call(this),push.call(this.thisValues,t),push.call(this.args,n),push.call(this.callIds,callId++),createCallProperties.call(this);try{this.invoking=!0,o=i?i.invoke(e,t,n):(this.func||e).apply(t,n),this.getCall(this.callCount-1).calledWithNew()&&"object"!=typeof o&&(o=t)}catch(e){r=e}finally{delete this.invoking}if(push.call(this.exceptions,r),push.call(this.returnValues,o),push.call(this.stacks,(new Error).stack),createCallProperties.call(this),void 0!==r)throw r;return o},named:function(e){return this.displayName=e,this},getCall:function(e){return e<0||e>=this.callCount?null:sinon.spyCall(this,this.thisValues[e],this.args[e],this.returnValues[e],this.exceptions[e],this.callIds[e],this.stacks[e])},getCalls:function(){var e,t=[];for(e=0;e<this.callCount;e++)t.push(this.getCall(e));return t},calledBefore:function(e){return!!this.called&&(!e.called||this.callIds[0]<e.callIds[e.callIds.length-1])},calledAfter:function(e){return!(!this.called||!e.called)&&this.callIds[this.callCount-1]>e.callIds[e.callCount-1]},withArgs:function(){var e=slice.call(arguments);if(this.fakes){var t=matchingFake(this.fakes,e,!0);if(t)return t}else this.fakes=[];var n=this,r=this.instantiateFake();r.matchingAguments=e,r.parent=this,push.call(this.fakes,r),r.withArgs=function(){return n.withArgs.apply(n,arguments)};for(var o=0;o<this.args.length;o++)r.matches(this.args[o])&&(incrementCallCount.call(r),push.call(r.thisValues,this.thisValues[o]),push.call(r.args,this.args[o]),push.call(r.returnValues,this.returnValues[o]),push.call(r.exceptions,this.exceptions[o]),push.call(r.callIds,this.callIds[o]));return createCallProperties.call(r),r},matches:function(e,t){var n=this.matchingAguments;if(n.length<=e.length&&sinon.deepEqual(n,e.slice(0,n.length)))return!t||n.length===e.length},printf:function(e){var n,r=this,o=slice.call(arguments,1);return(e||"").replace(/%(.)/g,function(e,t){return"function"==typeof(n=spyApi.formatters[t])?n.call(null,r,o):isNaN(parseInt(t,10))?"%"+t:sinon.format(o[t-1])})}};function delegateToCalls(o,i,s,a){spyApi[o]=function(){if(!this.called)return!!a&&a.apply(this,arguments);for(var e,t=0,n=0,r=this.callCount;n<r;n+=1)if((e=this.getCall(n))[s||o].apply(e,arguments)&&(t+=1,i))return!0;return t===this.callCount}}return delegateToCalls("calledOn",!0),delegateToCalls("alwaysCalledOn",!1,"calledOn"),delegateToCalls("calledWith",!0),delegateToCalls("calledWithMatch",!0),delegateToCalls("alwaysCalledWith",!1,"calledWith"),delegateToCalls("alwaysCalledWithMatch",!1,"calledWithMatch"),delegateToCalls("calledWithExactly",!0),delegateToCalls("alwaysCalledWithExactly",!1,"calledWithExactly"),delegateToCalls("neverCalledWith",!1,"notCalledWith",function(){return!0}),delegateToCalls("neverCalledWithMatch",!1,"notCalledWithMatch",function(){return!0}),delegateToCalls("threw",!0),delegateToCalls("alwaysThrew",!1,"threw"),delegateToCalls("returned",!0),delegateToCalls("alwaysReturned",!1,"returned"),delegateToCalls("calledWithNew",!0),delegateToCalls("alwaysCalledWithNew",!1,"calledWithNew"),delegateToCalls("callArg",!1,"callArgWith",function(){throw new Error(this.toString()+" cannot call arg since it was not yet invoked.")}),spyApi.callArgWith=spyApi.callArg,delegateToCalls("callArgOn",!1,"callArgOnWith",function(){throw new Error(this.toString()+" cannot call arg since it was not yet invoked.")}),spyApi.callArgOnWith=spyApi.callArgOn,delegateToCalls("yield",!1,"yield",function(){throw new Error(this.toString()+" cannot yield since it was not yet invoked.")}),spyApi.invokeCallback=spyApi.yield,delegateToCalls("yieldOn",!1,"yieldOn",function(){throw new Error(this.toString()+" cannot yield since it was not yet invoked.")}),delegateToCalls("yieldTo",!1,"yieldTo",function(e){throw new Error(this.toString()+" cannot yield to '"+e+"' since it was not yet invoked.")}),delegateToCalls("yieldToOn",!1,"yieldToOn",function(e){throw new Error(this.toString()+" cannot yield to '"+e+"' since it was not yet invoked.")}),spyApi.formatters={c:function(e){return sinon.timesInWords(e.callCount)},n:function(e){return e.toString()},C:function(e){for(var t=[],n=0,r=e.callCount;n<r;++n){var o="    "+e.getCall(n).toString();/\n/.test(t[n-1])&&(o="\n"+o),push.call(t,o)}return 0<t.length?"\n"+t.join("\n"):""},t:function(e){for(var t=[],n=0,r=e.callCount;n<r;++n)push.call(t,sinon.format(e.thisValues[n]));return t.join(", ")},"*":function(e,t){for(var n=[],r=0,o=t.length;r<o;++r)push.call(n,sinon.format(t[r]));return n.join(", ")}},sinon.extend(spy,spyApi),spy.spyCall=sinon.spyCall,sinon.spy=spy,spy}var isNode="undefined"!=typeof module&&module.exports&&"function"==typeof require,isAMD="function"==typeof define&&"object"==typeof define.amd&&define.amd;function loadDependencies(e,t,n){var r=e("./util/core");e("./call"),e("./extend"),e("./times_in_words"),e("./format"),n.exports=makeApi(r)}isAMD?define(loadDependencies):isNode?loadDependencies(require,module.exports,module):sinonGlobal&&makeApi(sinonGlobal)}("object"==typeof sinon&&sinon),function(e){var l=Array.prototype.slice,c=Array.prototype.join,u=-1,f=-2,h="object"==typeof process&&"function"==typeof process.nextTick?process.nextTick:"function"==typeof setImmediate?setImmediate:function(e){setTimeout(e,0)};function o(e,t){return"string"==typeof e?(this.exception=new Error(t||""),this.exception.name=e):this.exception=e||new Error("Error"),this}function i(a){function n(e,t){if("number"==typeof e.callArgAt){var n=function(e,t){var n,r=e.callArgAt;if(0<=r)return t[r];r===u&&(n=t),r===f&&(n=l.call(t).reverse());for(var o=e.callArgProp,i=0,s=n.length;i<s;++i){if(!o&&"function"==typeof n[i])return n[i];if(o&&n[i]&&"function"==typeof n[i][o])return n[i][o]}return null}(e,t);if("function"!=typeof n)throw new TypeError((o=n,i=t,(r=e).callArgAt<0?(s=r.callArgProp?a.functionName(r.stub)+" expected to yield to '"+r.callArgProp+"', but no object with such a property was passed.":a.functionName(r.stub)+" expected to yield, but no callback was passed.",0<i.length&&(s+=" Received ["+c.call(i,", ")+"]"),s):"argument at index "+r.callArgAt+" is not a function: "+o));e.callbackAsync?h(function(){n.apply(e.callbackContext,e.callbackArguments)}):n.apply(e.callbackContext,e.callbackArguments)}var r,o,i,s}var e={create:function(e){var t=a.extend({},a.behavior);return delete t.create,t.stub=e,t},isPresent:function(){return"number"==typeof this.callArgAt||this.exception||"number"==typeof this.returnArgAt||this.returnThis||this.returnValueDefined},invoke:function(e,t){if(n(this,t),this.exception)throw this.exception;return"number"==typeof this.returnArgAt?t[this.returnArgAt]:this.returnThis?e:this.returnValue},onCall:function(e){return this.stub.onCall(e)},onFirstCall:function(){return this.stub.onFirstCall()},onSecondCall:function(){return this.stub.onSecondCall()},onThirdCall:function(){return this.stub.onThirdCall()},withArgs:function(){throw new Error('Defining a stub by invoking "stub.onCall(...).withArgs(...)" is not supported. Use "stub.withArgs(...).onCall(...)" to define sequential behavior for calls with certain arguments.')},callsArg:function(e){if("number"!=typeof e)throw new TypeError("argument index is not number");return this.callArgAt=e,this.callbackArguments=[],this.callbackContext=void 0,this.callArgProp=void 0,this.callbackAsync=!1,this},callsArgOn:function(e,t){if("number"!=typeof e)throw new TypeError("argument index is not number");if("object"!=typeof t)throw new TypeError("argument context is not an object");return this.callArgAt=e,this.callbackArguments=[],this.callbackContext=t,this.callArgProp=void 0,this.callbackAsync=!1,this},callsArgWith:function(e){if("number"!=typeof e)throw new TypeError("argument index is not number");return this.callArgAt=e,this.callbackArguments=l.call(arguments,1),this.callbackContext=void 0,this.callArgProp=void 0,this.callbackAsync=!1,this},callsArgOnWith:function(e,t){if("number"!=typeof e)throw new TypeError("argument index is not number");if("object"!=typeof t)throw new TypeError("argument context is not an object");return this.callArgAt=e,this.callbackArguments=l.call(arguments,2),this.callbackContext=t,this.callArgProp=void 0,this.callbackAsync=!1,this},yields:function(){return this.callArgAt=u,this.callbackArguments=l.call(arguments,0),this.callbackContext=void 0,this.callArgProp=void 0,this.callbackAsync=!1,this},yieldsRight:function(){return this.callArgAt=f,this.callbackArguments=l.call(arguments,0),this.callbackContext=void 0,this.callArgProp=void 0,this.callbackAsync=!1,this},yieldsOn:function(e){if("object"!=typeof e)throw new TypeError("argument context is not an object");return this.callArgAt=u,this.callbackArguments=l.call(arguments,1),this.callbackContext=e,this.callArgProp=void 0,this.callbackAsync=!1,this},yieldsTo:function(e){return this.callArgAt=u,this.callbackArguments=l.call(arguments,1),this.callbackContext=void 0,this.callArgProp=e,this.callbackAsync=!1,this},yieldsToOn:function(e,t){if("object"!=typeof t)throw new TypeError("argument context is not an object");return this.callArgAt=u,this.callbackArguments=l.call(arguments,2),this.callbackContext=t,this.callArgProp=e,this.callbackAsync=!1,this},throws:o,throwsException:o,returns:function(e){return this.returnValue=e,this.returnValueDefined=!0,this.exception=void 0,this},returnsArg:function(e){if("number"!=typeof e)throw new TypeError("argument index is not number");return this.returnArgAt=e,this},returnsThis:function(){return this.returnThis=!0,this}};function t(t){return function(){var e=this[t].apply(this,arguments);return this.callbackAsync=!0,e}}for(var r in e)e.hasOwnProperty(r)&&r.match(/^(callsArg|yields)/)&&!r.match(/Async/)&&(e[r+"Async"]=t(r));return a.behavior=e}var t="undefined"!=typeof module&&module.exports&&"function"==typeof require;function n(e,t,n){var r=e("./util/core");e("./extend"),n.exports=i(r)}"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(n):t?n(require,module.exports,module):e&&i(e)}("object"==typeof sinon&&sinon),function(e){function o(e){return e.walk=function(e,t,n){return function e(n,r,o,i,s){var t,a;if("function"==typeof Object.getOwnPropertyNames)Object.getOwnPropertyNames(n).forEach(function(e){if(!s[e]){s[e]=!0;var t="function"==typeof Object.getOwnPropertyDescriptor(n,e).get?i:n;r.call(o,t[e],e,t)}}),(t=Object.getPrototypeOf(n))&&e(t,r,o,i,s);else for(a in n)r.call(o,n[a],a,n)}(e,t,n,e,{})},e.walk}function t(e,t,n){var r=e("./util/core");n.exports=o(r)}var n="undefined"!=typeof module&&module.exports&&"function"==typeof require;"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(t):n?t(require,module.exports,module):e&&o(e)}("object"==typeof sinon&&sinon),function(e){function o(a){function l(r,e,t){if(t&&"function"!=typeof t&&"object"!=typeof t)throw new TypeError("Custom stub should be a function or a property descriptor");var n;if(t){if("function"==typeof t)n=a.spy&&a.spy.create?a.spy.create(t):t;else if(n=t,a.spy&&a.spy.create)for(var o=a.objectKeys(n),i=0;i<o.length;i++)n[o[i]]=a.spy.create(n[o[i]])}else{var s=0;"object"==typeof r&&"function"==typeof r[e]&&(s=r[e].length),n=l.create(s)}return r||void 0!==e?void 0===e&&"object"==typeof r?(a.walk(r||{},function(e,t,n){n!==Object.prototype&&"constructor"!==t&&"function"==typeof a.getPropertyDescriptor(n,t).value&&l(r,t)}),r):a.wrapMethod(r,e,n):a.stub.create()}function n(e){return e.defaultBehavior||(t=e).parent&&r(t.parent)||a.behavior.create(e);var t}function r(e){var t=e.behaviors[e.callCount-1];return t&&t.isPresent()?t:n(e)}var o=0,e={create:function(e){var t=function(){return r(t).invoke(this,arguments)};t.id="stub#"+o++;var n=t;return(t=a.spy.create(t,e)).func=n,a.extend(t,l),t.instantiateFake=a.stub.create,t.displayName="stub",t.toString=a.functionToString,t.defaultBehavior=null,t.behaviors=[],t},resetBehavior:function(){var e;if(this.defaultBehavior=null,this.behaviors=[],delete this.returnValue,delete this.returnArgAt,this.returnThis=!1,this.fakes)for(e=0;e<this.fakes.length;e++)this.fakes[e].resetBehavior()},onCall:function(e){return this.behaviors[e]||(this.behaviors[e]=a.behavior.create(this)),this.behaviors[e]},onFirstCall:function(){return this.onCall(0)},onSecondCall:function(){return this.onCall(1)},onThirdCall:function(){return this.onCall(2)}};function t(e){return function(){return this.defaultBehavior=this.defaultBehavior||a.behavior.create(this),this.defaultBehavior[e].apply(this.defaultBehavior,arguments),this}}for(var i in a.behavior)a.behavior.hasOwnProperty(i)&&!e.hasOwnProperty(i)&&"create"!==i&&"withArgs"!==i&&"invoke"!==i&&(e[i]=t(i));return a.extend(l,e),a.stub=l}var t="undefined"!=typeof module&&module.exports&&"function"==typeof require;function n(e,t,n){var r=e("./util/core");e("./behavior"),e("./spy"),e("./extend"),n.exports=o(r)}"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(n):t?n(require,module.exports,module):e&&o(e)}("object"==typeof sinon&&sinon),function(e){function o(u){var f=[].push,n=u.match;function r(e){return e?r.create(e):u.expectation.create("Anonymous mock")}function o(e,t){if(e)for(var n=0,r=e.length;n<r;n+=1)t(e[n])}function h(e,t,n){if(n&&e.length!==t.length)return!1;for(var r=0,o=e.length;r<o;r++)if(!u.deepEqual(e[r],t[r]))return!1;return!0}u.extend(r,{create:function(e){if(!e)throw new TypeError("object is null");var t=u.extend({},r);return t.object=e,delete t.create,t},expects:function(e){if(!e)throw new TypeError("method is falsy");if(this.expectations||(this.expectations={},this.proxies=[]),!this.expectations[e]){this.expectations[e]=[];var t=this;u.wrapMethod(this.object,e,function(){return t.invokeMethod(e,this,arguments)}),f.call(this.proxies,e)}var n=u.expectation.create(e);return f.call(this.expectations[e],n),n},restore:function(){var t=this.object;o(this.proxies,function(e){"function"==typeof t[e].restore&&t[e].restore()})},verify:function(){var t=this.expectations||{},n=[],r=[];return o(this.proxies,function(e){o(t[e],function(e){e.met()?f.call(r,e.toString()):f.call(n,e.toString())})}),this.restore(),0<n.length?u.expectation.fail(n.concat(r).join("\n")):0<r.length&&u.expectation.pass(n.concat(r).join("\n")),!0},invokeMethod:function(e,t,n){var r,o,i=this.expectations&&this.expectations[e]?this.expectations[e]:[],s=[],a=n||[];for(r=0;r<i.length;r+=1){h(i[r].expectedArguments||[],a,i[r].expectsExactArgCount)&&s.push(i[r])}for(r=0;r<s.length;r+=1)if(!s[r].met()&&s[r].allowsCall(t,n))return s[r].apply(t,n);var l=[],c=0;for(r=0;r<s.length;r+=1)s[r].allowsCall(t,n)?o=o||s[r]:c+=1;if(o&&0===c)return o.apply(t,n);for(r=0;r<i.length;r+=1)f.call(l,"    "+i[r].toString());l.unshift("Unexpected call: "+u.spyCall.toString.call({proxy:e,args:n})),u.expectation.fail(l.join("\n"))}});var i=u.timesInWords,e=Array.prototype.slice;function s(e){return"number"==typeof e.maxCalls&&e.callCount===e.maxCalls}function a(e,t){return n&&n.isMatcher(e)&&e.test(t)||!0}return u.expectation={minCalls:1,maxCalls:1,create:function(e){var t=u.extend(u.stub.create(),u.expectation);return delete t.create,t.method=e,t},invoke:function(e,t,n){return this.verifyCallAllowed(t,n),u.spy.invoke.apply(this,arguments)},atLeast:function(e){if("number"!=typeof e)throw new TypeError("'"+e+"' is not number");return this.limitsSet||(this.maxCalls=null,this.limitsSet=!0),this.minCalls=e,this},atMost:function(e){if("number"!=typeof e)throw new TypeError("'"+e+"' is not number");return this.limitsSet||(this.minCalls=null,this.limitsSet=!0),this.maxCalls=e,this},never:function(){return this.exactly(0)},once:function(){return this.exactly(1)},twice:function(){return this.exactly(2)},thrice:function(){return this.exactly(3)},exactly:function(e){if("number"!=typeof e)throw new TypeError("'"+e+"' is not a number");return this.atLeast(e),this.atMost(e)},met:function(){return!this.failed&&(!("number"==typeof(e=this).minCalls)||e.callCount>=e.minCalls);var e},verifyCallAllowed:function(e,t){if(s(this)&&(this.failed=!0,u.expectation.fail(this.method+" already called "+i(this.maxCalls))),"expectedThis"in this&&this.expectedThis!==e&&u.expectation.fail(this.method+" called with "+e+" as thisValue, expected "+this.expectedThis),"expectedArguments"in this){t||u.expectation.fail(this.method+" received no arguments, expected "+u.format(this.expectedArguments)),t.length<this.expectedArguments.length&&u.expectation.fail(this.method+" received too few arguments ("+u.format(t)+"), expected "+u.format(this.expectedArguments)),this.expectsExactArgCount&&t.length!==this.expectedArguments.length&&u.expectation.fail(this.method+" received too many arguments ("+u.format(t)+"), expected "+u.format(this.expectedArguments));for(var n=0,r=this.expectedArguments.length;n<r;n+=1)a(this.expectedArguments[n],t[n])||u.expectation.fail(this.method+" received wrong arguments "+u.format(t)+", didn't match "+this.expectedArguments.toString()),u.deepEqual(this.expectedArguments[n],t[n])||u.expectation.fail(this.method+" received wrong arguments "+u.format(t)+", expected "+u.format(this.expectedArguments))}},allowsCall:function(e,t){if(this.met()&&s(this))return!1;if("expectedThis"in this&&this.expectedThis!==e)return!1;if(!("expectedArguments"in this))return!0;if((t=t||[]).length<this.expectedArguments.length)return!1;if(this.expectsExactArgCount&&t.length!==this.expectedArguments.length)return!1;for(var n=0,r=this.expectedArguments.length;n<r;n+=1){if(!a(this.expectedArguments[n],t[n]))return!1;if(!u.deepEqual(this.expectedArguments[n],t[n]))return!1}return!0},withArgs:function(){return this.expectedArguments=e.call(arguments),this},withExactArgs:function(){return this.withArgs.apply(this,arguments),this.expectsExactArgCount=!0,this},on:function(e){return this.expectedThis=e,this},toString:function(){var e=(this.expectedArguments||[]).slice();this.expectsExactArgCount||f.call(e,"[...]");var t,n=u.spyCall.toString.call({proxy:this.method||"anonymous mock expectation",args:e}).replace(", [...","[, ...")+" "+function(e){var t=e.minCalls,n=e.maxCalls;if("number"==typeof t&&"number"==typeof n){var r=i(t);return t!==n&&(r="at least "+r+" and at most "+i(n)),r}return"number"==typeof t?"at least "+i(t):"at most "+i(n)}(this);return this.met()?"Expectation met: "+n:"Expected "+n+" ("+(0===(t=this.callCount)?"never called":"called "+i(t))+")"},verify:function(){return this.met()?u.expectation.pass(this.toString()):u.expectation.fail(this.toString()),!0},pass:function(e){u.assert.pass(e)},fail:function(e){var t=new Error(e);throw t.name="ExpectationError",t}},u.mock=r}var t="undefined"!=typeof module&&module.exports&&"function"==typeof require;function n(e,t,n){var r=e("./util/core");e("./times_in_words"),e("./call"),e("./extend"),e("./match"),e("./spy"),e("./stub"),e("./format"),n.exports=o(r)}"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(n):t?n(require,module.exports,module):e&&o(e)}("object"==typeof sinon&&sinon),function(e){var t=[].push,a=Object.prototype.hasOwnProperty;function i(e){return e.fakes||(e.fakes=[]),e.fakes}function n(e,t){for(var n=i(e),r=0,o=n.length;r<o;r+=1)"function"==typeof n[r][t]&&n[r][t]()}function o(s){var e={verify:function(){n(this,"verify")},restore:function(){n(this,"restore"),function(e){for(var t=i(e);0<t.length;)t.splice(0,1)}(this)},reset:function(){n(this,"reset")},verifyAndRestore:function(){var t;try{this.verify()}catch(e){t=e}if(this.restore(),t)throw t},add:function(e){return t.call(i(this),e),e},spy:function(){return this.add(s.spy.apply(s,arguments))},stub:function(e,t,n){if(t){var r=e[t];if("function"!=typeof r){if(!a.call(e,t))throw new TypeError("Cannot stub non-existent own property "+t);return e[t]=n,this.add({restore:function(){e[t]=r}})}}if(!t&&e&&"object"==typeof e){var o=s.stub.apply(s,arguments);for(var i in o)"function"==typeof o[i]&&this.add(o[i]);return o}return this.add(s.stub.apply(s,arguments))},mock:function(){return this.add(s.mock.apply(s,arguments))},inject:function(e){var t=this;return e.spy=function(){return t.spy.apply(t,arguments)},e.stub=function(){return t.stub.apply(t,arguments)},e.mock=function(){return t.mock.apply(t,arguments)},e}};return s.collection=e}var r="undefined"!=typeof module&&module.exports&&"function"==typeof require;function s(e,t,n){var r=e("./util/core");e("./mock"),e("./spy"),e("./stub"),n.exports=o(r)}"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(s):r?s(require,module.exports,module):e&&o(e)}("object"==typeof sinon&&sinon),function(){function i(e,t){var r=void 0!==lolex?lolex:t;e.useFakeTimers=function(){var e,t=Array.prototype.slice.call(arguments);e="string"==typeof t[0]?0:t.shift();var n=r.install(e||0,t);return n.restore=n.uninstall,n},e.clock={create:function(e){return r.createClock(e)}},e.timers={setTimeout:setTimeout,clearTimeout:clearTimeout,setImmediate:"undefined"!=typeof setImmediate?setImmediate:void 0,clearImmediate:"undefined"!=typeof clearImmediate?clearImmediate:void 0,setInterval:setInterval,clearInterval:clearInterval,Date:Date}}var e="undefined"!=typeof module&&module.exports&&"function"==typeof require;function t(e,t,n,r){var o=e("./core");i(o,r),n.exports=o}"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(t):e?t(require,module.exports,module,require("lolex")):i(sinon)}(),void 0===sinon&&(this.sinon={}),function(){var n=[].push;function t(e){e.Event=function(e,t,n,r){this.initEvent(e,t,n,r)},e.Event.prototype={initEvent:function(e,t,n,r){this.type=e,this.bubbles=t,this.cancelable=n,this.target=r},stopPropagation:function(){},preventDefault:function(){this.defaultPrevented=!0}},e.ProgressEvent=function(e,t,n){this.initEvent(e,!1,!1,n),this.loaded="number"==typeof t.loaded?t.loaded:null,this.total="number"==typeof t.total?t.total:null,this.lengthComputable=!!t.total},e.ProgressEvent.prototype=new e.Event,e.ProgressEvent.prototype.constructor=e.ProgressEvent,e.CustomEvent=function(e,t,n){this.initEvent(e,!1,!1,n),this.detail=t.detail||null},e.CustomEvent.prototype=new e.Event,e.CustomEvent.prototype.constructor=e.CustomEvent,e.EventTarget={addEventListener:function(e,t){this.eventListeners=this.eventListeners||{},this.eventListeners[e]=this.eventListeners[e]||[],n.call(this.eventListeners[e],t)},removeEventListener:function(e,t){for(var n=this.eventListeners&&this.eventListeners[e]||[],r=0,o=n.length;r<o;++r)if(n[r]===t)return n.splice(r,1)},dispatchEvent:function(e){for(var t=e.type,n=this.eventListeners&&this.eventListeners[t]||[],r=0;r<n.length;r++)"function"==typeof n[r]?n[r].call(this,e):n[r].handleEvent(e);return!!e.defaultPrevented}}}var e="undefined"!=typeof module&&module.exports&&"function"==typeof require;function r(e){t(e("./core"))}"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(r):e?r(require):t(sinon)}(),function(e){var n=setTimeout;function o(o){function i(e,t){var n=e+" threw exception: ";function r(){throw t.message=n+t.message,t}o.log(n+"["+t.name+"] "+t.message),t.stack&&o.log(t.stack),i.useImmediateExceptions?r():i.setTimeout(r,0)}i.useImmediateExceptions=!1,i.setTimeout=function(e,t){n(e,t)};var e={};return e.log=o.log=function(){},e.logError=o.logError=i,e}function t(e,t,n){var r=e("./util/core");n.exports=o(r)}var r="undefined"!=typeof module&&module.exports&&"function"==typeof require;"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(t):r?t(require,module.exports,module):e&&o(e)}("object"==typeof sinon&&sinon),void 0===sinon&&(void 0===this?getGlobal().sinon={}:this.sinon={}),function(t){var o={XDomainRequest:t.XDomainRequest};function i(n){function r(){this.readyState=r.UNSENT,this.requestBody=null,this.requestHeaders={},this.status=0,this.timeout=null,"function"==typeof r.onCreate&&r.onCreate(this)}n.xdr=o,n.extend(r.prototype,n.EventTarget,{open:function(e,t){this.method=e,this.url=t,this.responseText=null,this.sendFlag=!1,this.readyStateChange(r.OPENED)},readyStateChange:function(e){this.readyState=e;var t="";switch(this.readyState){case r.UNSENT:case r.OPENED:break;case r.LOADING:this.sendFlag&&(t="onprogress");break;case r.DONE:t=this.isTimeout?"ontimeout":this.errorFlag||this.status<200||299<this.status?"onerror":"onload"}if(t&&"function"==typeof this[t])try{this[t]()}catch(e){n.logError("Fake XHR "+t+" handler",e)}},send:function(e){!function(e){if(e.readyState!==r.OPENED)throw new Error("INVALID_STATE_ERR");if(e.sendFlag)throw new Error("INVALID_STATE_ERR")}(this),/^(get|head)$/i.test(this.method)||(this.requestBody=e),this.requestHeaders["Content-Type"]="text/plain;charset=utf-8",this.errorFlag=!1,this.sendFlag=!0,this.readyStateChange(r.OPENED),"function"==typeof this.onSend&&this.onSend(this)},abort:function(){this.aborted=!0,this.responseText=null,this.errorFlag=!0,this.readyState>n.FakeXDomainRequest.UNSENT&&this.sendFlag&&(this.readyStateChange(n.FakeXDomainRequest.DONE),this.sendFlag=!1)},setResponseBody:function(e){!function(e){if(e.readyState===r.UNSENT)throw new Error("Request not sent");if(e.readyState===r.DONE)throw new Error("Request done")}(this),function(e){if("string"!=typeof e){var t=new Error("Attempted to respond to fake XDomainRequest with "+e+", which is not a string.");throw t.name="InvalidBodyException",t}}(e);var t=this.chunkSize||10,n=0;for(this.responseText="";this.readyStateChange(r.LOADING),this.responseText+=e.substring(n,n+t),(n+=t)<e.length;);this.readyStateChange(r.DONE)},respond:function(e,t,n){this.status="number"==typeof e?e:200,this.setResponseBody(n||"")},simulatetimeout:function(){this.status=0,this.isTimeout=!0,this.responseText=void 0,this.readyStateChange(r.DONE)}}),n.extend(r,{UNSENT:0,OPENED:1,LOADING:3,DONE:4}),n.useFakeXDomainRequest=function(){return n.FakeXDomainRequest.restore=function(e){o.supportsXDR&&(t.XDomainRequest=o.GlobalXDomainRequest),delete n.FakeXDomainRequest.restore,!0!==e&&delete n.FakeXDomainRequest.onCreate},o.supportsXDR&&(t.XDomainRequest=n.FakeXDomainRequest),n.FakeXDomainRequest},n.FakeXDomainRequest=r}o.GlobalXDomainRequest=t.XDomainRequest,o.supportsXDR=void 0!==o.GlobalXDomainRequest,o.workingXDR=!!o.supportsXDR&&o.GlobalXDomainRequest;var e="undefined"!=typeof module&&module.exports&&"function"==typeof require;function n(e,t,n){var r=e("./core");e("../extend"),e("./event"),e("../log_error"),i(r),n.exports=r}"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(n):e?n(require,module.exports,module):i(sinon)}("undefined"!=typeof global?global:self),function(e,t){var n,i="undefined"!=typeof ProgressEvent,r="undefined"!=typeof CustomEvent,s="undefined"!=typeof FormData,a="undefined"!=typeof ArrayBuffer,l=function(){try{return!!new Blob}catch(e){return!1}}(),c={XMLHttpRequest:t.XMLHttpRequest};c.GlobalXMLHttpRequest=t.XMLHttpRequest,c.GlobalActiveXObject=t.ActiveXObject,c.supportsActiveX=void 0!==c.GlobalActiveXObject,c.supportsXHR=void 0!==c.GlobalXMLHttpRequest,c.workingXHR=void 0!==(n=t).XMLHttpRequest?n.XMLHttpRequest:!(void 0===n.ActiveXObject)&&function(){return new n.ActiveXObject("MSXML2.XMLHTTP.3.0")},c.supportsCORS=c.supportsXHR&&"withCredentials"in new c.GlobalXMLHttpRequest;var u={"Accept-Charset":!0,"Accept-Encoding":!0,Connection:!0,"Content-Length":!0,Cookie:!0,Cookie2:!0,"Content-Transfer-Encoding":!0,Date:!0,Expect:!0,Host:!0,"Keep-Alive":!0,Referer:!0,TE:!0,Trailer:!0,"Transfer-Encoding":!0,Upgrade:!0,"User-Agent":!0,Via:!0};function o(){this.eventListeners={abort:[],error:[],load:[],loadend:[],progress:[]}}function f(){this.readyState=f.UNSENT,this.requestHeaders={},this.requestBody=null,this.status=0,this.statusText="",this.upload=new o,this.responseType="",this.response="",c.supportsCORS&&(this.withCredentials=!1);var r=this,e=["loadstart","load","abort","error","loadend"];function t(n){r.addEventListener(n,function(e){var t=r["on"+n];t&&"function"==typeof t&&t.call(this,e)})}for(var n=e.length-1;0<=n;n--)t(e[n]);"function"==typeof f.onCreate&&f.onCreate(this)}function h(e){if(e.readyState!==f.OPENED)throw new Error("INVALID_STATE_ERR");if(e.sendFlag)throw new Error("INVALID_STATE_ERR")}function p(e,t){for(var n in t=t.toLowerCase(),e)if(n.toLowerCase()===t)return n;return null}function d(e,t){if(e)for(var n=0,r=e.length;n<r;n+=1)t(e[n])}o.prototype.addEventListener=function(e,t){this.eventListeners[e].push(t)},o.prototype.removeEventListener=function(e,t){for(var n=this.eventListeners[e]||[],r=0,o=n.length;r<o;++r)if(n[r]===t)return n.splice(r,1)},o.prototype.dispatchEvent=function(e){for(var t,n=this.eventListeners[e.type]||[],r=0;null!=(t=n[r]);r++)t(e)};var y=function(e,t,n){switch(n.length){case 0:return e[t]();case 1:return e[t](n[0]);case 2:return e[t](n[0],n[1]);case 3:return e[t](n[0],n[1],n[2]);case 4:return e[t](n[0],n[1],n[2],n[3]);case 5:return e[t](n[0],n[1],n[2],n[3],n[4])}};f.filters=[],f.addFilter=function(e){this.filters.push(e)};var m=/MSIE 6/;function g(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r<e.length;r++){var o=e.charCodeAt(r);if(256<=o)throw new TypeError("arraybuffer or blob responseTypes require binary string, invalid character "+e[r]+" found.");n[r]=o}return t}function v(e){return!e||/(text\/xml)|(application\/xml)|(\+xml)/.test(e)}function b(e){""===e.responseType||"text"===e.responseType?e.response=e.responseText="":e.response=e.responseText=null,e.responseXML=null}function w(o){o.xhr=c,o.extend(f.prototype,o.EventTarget,{async:!0,open:function(e,t,n,r,o){if(this.method=e,this.url=t,this.async="boolean"!=typeof n||n,this.username=r,this.password=o,b(this),this.requestHeaders={},!(this.sendFlag=!1)===f.useFilters){var i=arguments;if(function(e,t){for(var n=0;n<e.length;n++)if(!0===t(e[n]))return!0;return!1}(f.filters,function(e){return e.apply(this,i)}))return f.defake(this,arguments)}this.readyStateChange(f.OPENED)},readyStateChange:function(e){this.readyState=e;var t,n,r=new o.Event("readystatechange",!1,!1,this);if("function"==typeof this.onreadystatechange)try{this.onreadystatechange(r)}catch(e){o.logError("Fake XHR onreadystatechange handler",e)}this.readyState===f.DONE&&(n={loaded:this.progress||0,total:this.progress||0},t=0===this.status?this.aborted?"abort":"error":"load",i&&(this.upload.dispatchEvent(new o.ProgressEvent("progress",n,this)),this.upload.dispatchEvent(new o.ProgressEvent(t,n,this)),this.upload.dispatchEvent(new o.ProgressEvent("loadend",n,this))),this.dispatchEvent(new o.ProgressEvent("progress",n,this)),this.dispatchEvent(new o.ProgressEvent(t,n,this)),this.dispatchEvent(new o.ProgressEvent("loadend",n,this))),this.dispatchEvent(r)},setRequestHeader:function(e,t){if(h(this),u[e]||/^(Sec-|Proxy-)/.test(e))throw new Error('Refused to set unsafe header "'+e+'"');this.requestHeaders[e]?this.requestHeaders[e]+=","+t:this.requestHeaders[e]=t},setResponseHeaders:function(e){for(var t in function(e){if(e.readyState!==f.OPENED)throw new Error("INVALID_STATE_ERR - "+e.readyState)}(this),this.responseHeaders={},e)e.hasOwnProperty(t)&&(this.responseHeaders[t]=e[t]);this.async?this.readyStateChange(f.HEADERS_RECEIVED):this.readyState=f.HEADERS_RECEIVED},send:function(e){if(h(this),!/^(get|head)$/i.test(this.method)){var t=p(this.requestHeaders,"Content-Type");if(this.requestHeaders[t]){var n=this.requestHeaders[t].split(";");this.requestHeaders[t]=n[0]+";charset=utf-8"}else!s||e instanceof FormData||(this.requestHeaders["Content-Type"]="text/plain;charset=utf-8");this.requestBody=e}this.errorFlag=!1,this.sendFlag=this.async,b(this),this.readyStateChange(f.OPENED),"function"==typeof this.onSend&&this.onSend(this),this.dispatchEvent(new o.Event("loadstart",!1,!1,this))},abort:function(){this.aborted=!0,b(this),this.errorFlag=!0,this.requestHeaders={},this.responseHeaders={},this.readyState>f.UNSENT&&this.sendFlag&&(this.readyStateChange(f.DONE),this.sendFlag=!1),this.readyState=f.UNSENT},error:function(){b(this),this.errorFlag=!0,this.requestHeaders={},this.responseHeaders={},this.readyStateChange(f.DONE)},getResponseHeader:function(e){return this.readyState<f.HEADERS_RECEIVED?null:/^Set-Cookie2?$/i.test(e)?null:(e=p(this.responseHeaders,e),this.responseHeaders[e]||null)},getAllResponseHeaders:function(){if(this.readyState<f.HEADERS_RECEIVED)return"";var e="";for(var t in this.responseHeaders)this.responseHeaders.hasOwnProperty(t)&&!/^Set-Cookie2?$/i.test(t)&&(e+=t+": "+this.responseHeaders[t]+"\r\n");return e},setResponseBody:function(e){!function(e){if(e.readyState===f.DONE)throw new Error("Request done")}(this),function(e){if(e.async&&e.readyState!==f.HEADERS_RECEIVED)throw new Error("No headers received")}(this),function(e){if("string"!=typeof e){var t=new Error("Attempted to respond to fake XMLHttpRequest with "+e+", which is not a string.");throw t.name="InvalidBodyException",t}}(e);var t=this.getResponseHeader("Content-Type"),n=""===this.responseType||"text"===this.responseType;if(b(this),this.async)for(var r=this.chunkSize||10,o=0;this.readyStateChange(f.LOADING),n&&(this.responseText=this.response+=e.substring(o,o+r)),(o+=r)<e.length;);this.response=function(e,t,n){if(""===e||"text"===e)return n;if(a&&"arraybuffer"===e)return g(n);if("json"===e)try{return JSON.parse(n)}catch(e){return null}else{if(l&&"blob"===e){var r={};return t&&(r.type=t),new Blob([g(n)],r)}if("document"===e)return v(t)?f.parseXML(n):null}throw new Error("Invalid responseType "+e)}(this.responseType,t,e),n&&(this.responseText=this.response),"document"===this.responseType?this.responseXML=this.response:""===this.responseType&&v(t)&&(this.responseXML=f.parseXML(this.responseText)),this.progress=e.length,this.readyStateChange(f.DONE)},respond:function(e,t,n){this.status="number"==typeof e?e:200,this.statusText=f.statusCodes[this.status],this.setResponseHeaders(t||{}),this.setResponseBody(n||"")},uploadProgress:function(e){i&&this.upload.dispatchEvent(new o.ProgressEvent("progress",e))},downloadProgress:function(e){i&&this.dispatchEvent(new o.ProgressEvent("progress",e))},uploadError:function(e){r&&this.upload.dispatchEvent(new o.CustomEvent("error",{detail:e}))}}),o.extend(f,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4}),o.useFakeXMLHttpRequest=function(){return f.restore=function(e){c.supportsXHR&&(t.XMLHttpRequest=c.GlobalXMLHttpRequest),c.supportsActiveX&&(t.ActiveXObject=c.GlobalActiveXObject),delete f.restore,!0!==e&&delete f.onCreate},c.supportsXHR&&(t.XMLHttpRequest=f),c.supportsActiveX&&(t.ActiveXObject=function(e){return"Microsoft.XMLHTTP"===e||/^Msxml2\.XMLHTTP/i.test(e)?new f:new c.GlobalActiveXObject(e)}),f},o.FakeXMLHttpRequest=f}f.defake=function(t,e){var n=new c.workingXHR;d(["open","setRequestHeader","send","abort","getResponseHeader","getAllResponseHeaders","addEventListener","overrideMimeType","removeEventListener"],function(e){t[e]=function(){return y(n,e,arguments)}});var r=function(e){d(e,function(e){try{t[e]=n[e]}catch(e){if(!m.test(navigator.userAgent))throw e}})},o=function(){t.readyState=n.readyState,n.readyState>=f.HEADERS_RECEIVED&&r(["status","statusText"]),n.readyState>=f.LOADING&&r(["responseText","response"]),n.readyState===f.DONE&&r(["responseXML"]),t.onreadystatechange&&t.onreadystatechange.call(t,{target:t})};if(n.addEventListener){for(var i in t.eventListeners)t.eventListeners.hasOwnProperty(i)&&d(t.eventListeners[i],function(e){n.addEventListener(i,e)});n.addEventListener("readystatechange",o)}else n.onreadystatechange=o;y(n,"open",e)},f.useFilters=!1,f.parseXML=function(e){if(""!==e)try{if("undefined"!=typeof DOMParser)return(new DOMParser).parseFromString(e,"text/xml");var t=new window.ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t}catch(e){}return null},f.statusCodes={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",300:"Multiple Choice",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported"};var x="undefined"!=typeof module&&module.exports&&"function"==typeof require;function C(e,t,n){var r=e("./core");e("../extend"),e("./event"),e("../log_error"),w(r),n.exports=r}"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(C):x?C(require,module.exports,module):e&&w(e)}("object"==typeof sinon&&sinon,"undefined"!=typeof global?global:self),function(){var o=[].push;function i(e){var t=e;if("[object Array]"!==Object.prototype.toString.call(e)&&(t=[200,{},e]),"string"!=typeof t[2])throw new TypeError("Fake server response body should be string, but was "+typeof t[2]);return t}var e="undefined"!=typeof window?window.location:{},h=new RegExp("^"+e.protocol+"//"+e.host);function s(e,t){var n,r,o,i,s,a,l,c=t.url;if(/^https?:\/\//.test(c)&&!h.test(c)||(c=c.replace(h,"")),n=e,r=this.getHTTPMethod(t),o=c,i=n.method,s=!i||i.toLowerCase()===r.toLowerCase(),a=n.url,l=!a||a===o||"function"==typeof a.test&&a.test(o),s&&l){if("function"==typeof e.response){var u=e.url,f=[t].concat(u&&"function"==typeof u.exec?u.exec(c).slice(1):[]);return e.response.apply(e,f)}return!0}return!1}function a(r){r.fakeServer={create:function(e){var t=r.create(this);return t.configure(e),r.xhr.supportsCORS?this.xhr=r.useFakeXMLHttpRequest():this.xhr=r.useFakeXDomainRequest(),t.requests=[],this.xhr.onCreate=function(e){t.addRequest(e)},t},configure:function(e){var t,n={autoRespond:!0,autoRespondAfter:!0,respondImmediately:!0,fakeHTTPMethods:!0};for(t in e=e||{})n.hasOwnProperty(t)&&e.hasOwnProperty(t)&&(this[t]=e[t])},addRequest:function(e){var t=this;o.call(this.requests,e),e.onSend=function(){t.handleRequest(this),t.respondImmediately?t.respond():t.autoRespond&&!t.responding&&(setTimeout(function(){t.responding=!1,t.respond()},t.autoRespondAfter||10),t.responding=!0)}},getHTTPMethod:function(e){if(this.fakeHTTPMethods&&/post/i.test(e.method)){var t=(e.requestBody||"").match(/_method=([^\b;]+)/);return t?t[1]:e.method}return e.method},handleRequest:function(e){e.async?(this.queue||(this.queue=[]),o.call(this.queue,e)):this.processRequest(e)},log:function(e,t){var n;n="Request:\n"+r.format(t)+"\n\n",n+="Response:\n"+r.format(e)+"\n\n",r.log(n)},respondWith:function(e,t,n){1!==arguments.length||"function"==typeof e?(this.responses||(this.responses=[]),1===arguments.length&&(n=e,t=e=null),2===arguments.length&&(n=t,t=e,e=null),o.call(this.responses,{method:e,url:t,response:"function"==typeof n?n:i(n)})):this.response=i(e)},respond:function(){0<arguments.length&&this.respondWith.apply(this,arguments);for(var e=this.queue||[],t=e.splice(0,e.length),n=0;n<t.length;n++)this.processRequest(t[n])},processRequest:function(e){try{if(e.aborted)return;var t=this.response||[404,{},""];if(this.responses)for(var n=this.responses.length-1;0<=n;n--)if(s.call(this,this.responses[n],e)){t=this.responses[n].response;break}4!==e.readyState&&(this.log(t,e),e.respond(t[0],t[1],t[2]))}catch(e){r.logError("Fake server request processing",e)}},restore:function(){return this.xhr.restore&&this.xhr.restore.apply(this.xhr,arguments)}}}var t="undefined"!=typeof module&&module.exports&&"function"==typeof require;function n(e,t,n){var r=e("./core");e("./fake_xdomain_request"),e("./fake_xml_http_request"),e("../format"),a(r),n.exports=r}"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(n):t?n(require,module.exports,module):a(sinon)}(),function(){function n(t){function e(){}e.prototype=t.fakeServer,t.fakeServerWithClock=new e,t.fakeServerWithClock.addRequest=function(e){if(e.async&&("object"==typeof setTimeout.clock?this.clock=setTimeout.clock:(this.clock=t.useFakeTimers(),this.resetClock=!0),!this.longestTimeout)){var n=this.clock.setTimeout,r=this.clock.setInterval,o=this;this.clock.setTimeout=function(e,t){return o.longestTimeout=Math.max(t,o.longestTimeout||0),n.apply(this,arguments)},this.clock.setInterval=function(e,t){return o.longestTimeout=Math.max(t,o.longestTimeout||0),r.apply(this,arguments)}}return t.fakeServer.addRequest.call(this,e)},t.fakeServerWithClock.respond=function(){var e=t.fakeServer.respond.apply(this,arguments);return this.clock&&(this.clock.tick(this.longestTimeout||0),this.longestTimeout=0,this.resetClock&&(this.clock.restore(),this.resetClock=!1)),e},t.fakeServerWithClock.restore=function(){return this.clock&&this.clock.restore(),t.fakeServer.restore.apply(this,arguments)}}var e="undefined"!=typeof module&&module.exports&&"function"==typeof require;function t(e){var t=e("./core");e("./fake_server"),e("./fake_timers"),n(t)}"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(t):e?t(require):n(sinon)}(),function(e){function o(c){var o=[].push;function u(e,t,n,r){r&&(!t.injectInto||n in t.injectInto?o.call(e.args,r):(t.injectInto[n]=r,e.injectedKeys.push(n)))}return c.sandbox=c.extend(c.create(c.collection),{useFakeTimers:function(){return this.clock=c.useFakeTimers.apply(c,arguments),this.add(this.clock)},serverPrototype:c.fakeServer,useFakeServer:function(){var e=this.serverPrototype||c.fakeServer;return e&&e.create?(this.server=e.create(),this.add(this.server)):null},inject:function(e){return c.collection.inject.call(this,e),this.clock&&(e.clock=this.clock),this.server&&(e.server=this.server,e.requests=this.server.requests),e.match=c.match,e},restore:function(){if(arguments.length)throw new Error("sandbox.restore() does not take any parameters. Perhaps you meant stub.restore()");c.collection.restore.apply(this,arguments),this.restoreContext()},restoreContext:function(){if(this.injectedKeys){for(var e=0,t=this.injectedKeys.length;e<t;e++)delete this.injectInto[this.injectedKeys[e]];this.injectedKeys=[]}},create:function(e){if(!e)return c.create(c.sandbox);var t,n,r,o,i=(t=e,n=c.create(c.sandbox),t.useFakeServer&&("object"==typeof t.useFakeServer&&(n.serverPrototype=t.useFakeServer),n.useFakeServer()),t.useFakeTimers&&("object"==typeof t.useFakeTimers?n.useFakeTimers.apply(n,t.useFakeTimers):n.useFakeTimers()),n);i.args=i.args||[],i.injectedKeys=[],i.injectInto=e.injectInto;var s=i.inject({});if(e.properties)for(var a=0,l=e.properties.length;a<l;a++)u(i,e,r=e.properties[a],o=s[r]||"sandbox"===r&&i);else u(i,e,"sandbox",o);return i},match:c.match}),c.sandbox.useFakeXMLHttpRequest=c.sandbox.useFakeServer,c.sandbox}var t="undefined"!=typeof module&&module.exports&&"function"==typeof require;function n(e,t,n){var r=e("./util/core");e("./extend"),e("./util/fake_server_with_clock"),e("./util/fake_timers"),e("./collection"),n.exports=o(r)}"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(n):t?n(require,module.exports,module):e&&o(e)}("object"==typeof sinon&&sinon),function(e){function o(a){var l=Array.prototype.slice;function e(s){var e=typeof s;if("function"!==e)throw new TypeError("sinon.test needs to wrap a test function, got "+e);function t(){var e=a.getConfig(a.config);e.injectInto=e.injectIntoThis&&this||e.injectInto;var t,n,r=a.sandbox.create(e),o=l.call(arguments),i=o.length&&o[o.length-1];"function"==typeof i&&(o[o.length-1]=function(e){e?r.restore():r.verifyAndRestore(),i(e)});try{n=s.apply(this,o.concat(r.args))}catch(e){t=e}if(void 0!==t)throw r.restore(),t;return"function"!=typeof i&&r.verifyAndRestore(),n}return s.length?function(e){return t.apply(this,arguments)}:t}return e.config={injectIntoThis:!0,injectInto:null,properties:["spy","stub","mock","clock","server","requests"],useFakeTimers:!0,useFakeServer:!0},a.test=e}var t="undefined"!=typeof module&&module.exports&&"function"==typeof require;function n(e,t,n){var r=e("./util/core");e("./sandbox"),n.exports=o(r)}"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(n):t?n(require,module.exports,module):e&&o(e)}("object"==typeof sinon&&sinon||null),function(e){function u(n,r,o){return function(){var t,e;r&&r.apply(this,arguments);try{e=n.apply(this,arguments)}catch(e){t=e}if(o&&o.apply(this,arguments),t)throw t;return e}}function o(c){function e(e,t){if(!e||"object"!=typeof e)throw new TypeError("sinon.testCase needs an object with test functions");t=t||"test";var n,r,o,i=new RegExp("^"+t),s={},a=e.setUp,l=e.tearDown;for(n in e)e.hasOwnProperty(n)&&!/^(setUp|tearDown)$/.test(n)&&("function"==typeof(r=e[n])&&i.test(n)?(o=r,(a||l)&&(o=u(r,a,l)),s[n]=c.test(o)):s[n]=e[n]);return s}return c.testCase=e}var t="undefined"!=typeof module&&module.exports&&"function"==typeof require;function n(e,t,n){var r=e("./util/core");e("./test"),n.exports=o(r)}"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(n):t?n(require,module.exports,module):e&&o(e)}("object"==typeof sinon&&sinon),function(e,n){var l=Array.prototype.slice;function o(o){var i;function s(){for(var e,t=0,n=arguments.length;t<n;++t)(e=arguments[t])||i.fail("fake is not a spy"),e.proxy&&e.proxy.isSinonProxy?s(e.proxy):("function"!=typeof e&&i.fail(e+" is not a function"),"function"!=typeof e.getCall&&i.fail(e+" is not stubbed"))}function a(e,t){((e=e||n).fail||i.fail).call(e,t)}function e(n,r,o){2===arguments.length&&(o=r,r=n),i[n]=function(e){s(e);var t=l.call(arguments,1);!function(e,t){switch(e){case"notCalled":case"called":case"calledOnce":case"calledTwice":case"calledThrice":0!==t.length&&i.fail(e+" takes 1 argument but was called with "+(t.length+1)+" arguments")}}(n,t);("function"==typeof r?!r(e):"function"==typeof e[r]?!e[r].apply(e,t):!e[r])?a(this,(e.printf||e.proxy.printf).apply(e,[o].concat(t))):i.pass(n)}}return i={failException:"AssertError",fail:function(e){var t=new Error(e);throw t.name=this.failException||i.failException,t},pass:function(){},callOrder:function(){s.apply(null,arguments);var e="",t="";if(o.calledInOrder(arguments))i.pass("callOrder");else{try{e=[].join.call(arguments,", ");for(var n=l.call(arguments),r=n.length;r;)n[--r].called||n.splice(r,1);t=o.orderByFirstCall(n).join(", ")}catch(e){}a(this,"expected "+e+" to be called in order but were called as "+t)}},callCount:function(e,t){if(s(e),e.callCount!==t){var n="expected %n to be called "+o.timesInWords(t)+" but was called %c%C";a(this,e.printf(n))}else i.pass("callCount")},expose:function(e,t){if(!e)throw new TypeError("target is null or undefined");var n,r,o=t||{},i=void 0===o.prefix?"assert":o.prefix,s=void 0===o.includeFail||!!o.includeFail;for(var a in this)"expose"===a||!s&&/^(fail)/.test(a)||(e[(n=i,r=a,!n||/^fail/.test(r)?r:n+r.slice(0,1).toUpperCase()+r.slice(1))]=this[a]);return e},match:function(e,t){o.match(t).test(e)?i.pass("match"):a(this,["expected value to match","    expected = "+o.format(t),"    actual = "+o.format(e)].join("\n"))}},e("called","expected %n to have been called at least once but was never called"),e("notCalled",function(e){return!e.called},"expected %n to not have been called but was called %c%C"),e("calledOnce","expected %n to be called once but was called %c%C"),e("calledTwice","expected %n to be called twice but was called %c%C"),e("calledThrice","expected %n to be called thrice but was called %c%C"),e("calledOn","expected %n to be called with %1 as this but was called with %t"),e("alwaysCalledOn","expected %n to always be called with %1 as this but was called with %t"),e("calledWithNew","expected %n to be called with new"),e("alwaysCalledWithNew","expected %n to always be called with new"),e("calledWith","expected %n to be called with arguments %*%C"),e("calledWithMatch","expected %n to be called with match %*%C"),e("alwaysCalledWith","expected %n to always be called with arguments %*%C"),e("alwaysCalledWithMatch","expected %n to always be called with match %*%C"),e("calledWithExactly","expected %n to be called with exact arguments %*%C"),e("alwaysCalledWithExactly","expected %n to always be called with exact arguments %*%C"),e("neverCalledWith","expected %n to never be called with arguments %*%C"),e("neverCalledWithMatch","expected %n to never be called with match %*%C"),e("threw","%n did not throw exception%C"),e("alwaysThrew","%n did not always throw exception%C"),o.assert=i}var t="undefined"!=typeof module&&module.exports&&"function"==typeof require;function r(e,t,n){var r=e("./util/core");e("./match"),e("./format"),n.exports=o(r)}"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(r):t?r(require,module.exports,module):e&&o(e)}("object"==typeof sinon&&sinon,"undefined"!=typeof global?global:self),sinon});
